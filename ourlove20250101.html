<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>我们的浪漫记忆</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="manifest" href="/manifest.json">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>❤️</text></svg>">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            min-height: 100vh;
            min-height: -webkit-fill-available;
            color: #fff;
            overflow-x: hidden;
            touch-action: pan-y;
        }
        
        html {
            height: -webkit-fill-available;
        }
        
        /* 移动端优化：防止双击缩放 */
        * {
            touch-action: manipulation;
        }
        
        /* 登录界面 - 移动端优化 */
        .login-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            z-index: 2000;
            transition: opacity 0.8s ease;
            padding: 20px;
        }
        
        .login-box {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 40px 25px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.15);
            text-align: center;
        }
        
        .login-box h1 {
            font-size: 2rem;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #ff6b9d, #c779d0, #4bc0c8);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            word-break: break-word;
        }
        
        .login-box p {
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 25px;
            font-size: 1rem;
            line-height: 1.5;
        }
        
        .input-group {
            margin-bottom: 20px;
            text-align: left;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.95rem;
        }
        
        .input-group input {
            width: 100%;
            padding: 16px 20px;
            border-radius: 50px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 16px; /* 防止iOS自动缩放 */
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s;
            -webkit-appearance: none;
        }
        
        .input-group input:focus {
            outline: none;
            border-color: #ff6b9d;
            box-shadow: 0 0 0 3px rgba(255, 107, 157, 0.2);
        }
        
        .remember {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.95rem;
        }
        
        .remember input {
            margin-right: 10px;
            width: 18px;
            height: 18px;
        }
        
        .login-btn {
            width: 100%;
            padding: 16px;
            border-radius: 50px;
            border: none;
            background: linear-gradient(45deg, #ff6b9d, #c779d0);
            color: white;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(255, 107, 157, 0.4);
            margin-top: 10px;
        }
        
        .login-btn:active {
            transform: scale(0.98);
        }
        
        .error-message {
            color: #ff6b6b;
            margin-top: 15px;
            min-height: 20px;
            display: none;
            font-size: 0.9rem;
        }
        
        /* 移动端提示 */
        .mobile-tips {
            background: rgba(255, 107, 157, 0.1);
            border-radius: 10px;
            padding: 12px 15px;
            margin-top: 20px;
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.7);
            text-align: left;
            border: 1px solid rgba(255, 107, 157, 0.2);
        }
        
        .mobile-tips i {
            color: #4bc0c8;
            margin-right: 8px;
        }
        
        /* 3D照片墙容器 - 移动端优化 */
        #photo3dContainer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 900;
            opacity: 1;
            transition: all 1.5s ease;
            pointer-events: all;
        }
        
        #photo3dContainer.minimized {
            width: 120px;
            height: 90px;
            top: 15px;
            left: 15px;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        @media (min-width: 768px) {
            #photo3dContainer.minimized {
                width: 200px;
                height: 150px;
                top: 20px;
                left: 20px;
            }
        }
        
        /* 主内容区域 */
        .main-container {
            opacity: 0;
            transition: opacity 1s ease;
            padding: 15px;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .main-container.visible {
            opacity: 1;
        }
        
        /* 标题区域 - 移动端优化 */
        .header {
            text-align: center;
            padding: 20px 15px;
            margin-bottom: 20px;
            position: relative;
        }
        
        .header h1 {
            font-size: 2rem;
            background: linear-gradient(45deg, #ff6b9d, #c779d0, #4bc0c8);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .header p {
            font-size: 1rem;
            color: rgba(255, 255, 255, 0.8);
            max-width: 600px;
            margin: 0 auto 20px;
            line-height: 1.5;
        }
        
        /* 用户中心 - 移动端优化 */
        .user-center {
            position: absolute;
            top: 15px;
            right: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 1000;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 8px;
            border-radius: 50px;
            background: rgba(255, 255, 255, 0.1);
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(45deg, #ff6b9d, #c779d0);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }
        
        .user-name {
            font-weight: 600;
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.95rem;
        }
        
        .user-menu {
            position: absolute;
            top: 60px;
            right: 0;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 15px;
            width: 200px;
            display: none;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            z-index: 1001;
        }
        
        .user-menu.visible {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        .menu-item {
            padding: 12px 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.95rem;
        }
        
        .menu-item:hover, .menu-item:active {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .menu-item i {
            width: 20px;
            text-align: center;
        }
        
        /* 控制面板 - 移动端优化 */
        .control-panel {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
            gap: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .upload-section {
            flex: 1;
            min-width: 100%;
        }
        
        @media (min-width: 768px) {
            .upload-section {
                min-width: 300px;
            }
        }
        
        .upload-btn {
            display: inline-block;
            background: linear-gradient(45deg, #ff6b9d, #c779d0);
            color: white;
            padding: 15px 25px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(255, 107, 157, 0.3);
            border: none;
            width: 100%;
        }
        
        .upload-btn:active {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 107, 157, 0.4);
        }
        
        .upload-btn i {
            margin-right: 10px;
        }
        
        #fileInput {
            display: none;
        }
        
        .upload-progress {
            width: 100%;
            height: 6px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            margin-top: 15px;
            overflow: hidden;
            display: none;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #ff6b9d, #c779d0);
            width: 0%;
            transition: width 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            animation: shimmer 2s infinite;
        }
        
        .photo-counter {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px 20px;
            border-radius: 30px;
            font-weight: 600;
            color: white;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 0.95rem;
        }
        
        .photo-counter i {
            margin-right: 8px;
            color: #ff6b9d;
        }
        
        .filter-section {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .filter-btn {
            padding: 10px 18px;
            border-radius: 30px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.1);
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
            font-size: 0.9rem;
        }
        
        .filter-btn:active, .filter-btn.active {
            background: rgba(255, 255, 255, 0.2);
            border-color: #ff6b9d;
        }
        
        /* 照片墙 - 移动端优化 */
        .photo-wall {
            column-count: 1;
            column-gap: 15px;
        }
        
        @media (min-width: 480px) {
            .photo-wall {
                column-count: 2;
            }
        }
        
        @media (min-width: 768px) {
            .photo-wall {
                column-count: 3;
            }
        }
        
        @media (min-width: 1200px) {
            .photo-wall {
                column-count: 4;
            }
        }
        
        .photo-item {
            break-inside: avoid;
            margin-bottom: 15px;
            border-radius: 12px;
            overflow: hidden;
            background: rgba(255, 255, 255, 0.05);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            transition: all 0.4s ease;
            position: relative;
            cursor: pointer;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .photo-item:active {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4);
            background: rgba(255, 255, 255, 0.1);
        }
        
        .photo-item img {
            width: 100%;
            height: auto;
            display: block;
            transition: transform 0.5s ease;
        }
        
        .photo-item:active img {
            transform: scale(1.05);
        }
        
        .photo-info {
            padding: 12px;
            background: rgba(0, 0, 0, 0.3);
        }
        
        .photo-title {
            font-weight: 600;
            color: #ff9dc5;
            margin-bottom: 5px;
            font-size: 1rem;
        }
        
        .photo-date {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.85rem;
            margin-bottom: 10px;
        }
        
        .photo-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .like-btn {
            color: #ff6b9d;
            background: none;
            border: none;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s;
            padding: 5px;
        }
        
        .like-btn.liked {
            animation: pop 0.4s;
        }
        
        .delete-btn {
            color: rgba(255, 255, 255, 0.6);
            background: none;
            border: none;
            font-size: 1.1rem;
            cursor: pointer;
            transition: color 0.3s;
            padding: 5px;
        }
        
        .delete-btn:active {
            color: #ff6b6b;
        }
        
        /* 空状态 */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #c779d0;
            grid-column: 1 / -1;
        }
        
        .empty-state i {
            font-size: 3.5rem;
            margin-bottom: 15px;
            opacity: 0.7;
        }
        
        .empty-state h2 {
            font-size: 1.5rem;
            margin-bottom: 10px;
        }
        
        .empty-state p {
            font-size: 1rem;
            color: rgba(255, 255, 255, 0.7);
        }
        
        /* 模态框 - 移动端优化 */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.95);
            z-index: 1100;
            justify-content: center;
            align-items: center;
            padding: 10px;
        }
        
        .modal-content {
            max-width: 100%;
            max-height: 80%;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
        }
        
        .modal-content img {
            width: 100%;
            height: auto;
            display: block;
        }
        
        .close-modal {
            position: absolute;
            top: 20px;
            right: 20px;
            color: white;
            font-size: 2.5rem;
            cursor: pointer;
            transition: color 0.3s;
            background: rgba(0, 0, 0, 0.5);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .close-modal:active {
            color: #ff6b9d;
        }
        
        /* 动画 */
        @keyframes heartbeat {
            0% { transform: scale(1); }
            5% { transform: scale(1.3); }
            10% { transform: scale(1.1); }
            15% { transform: scale(1.3); }
            20% { transform: scale(1); }
            100% { transform: scale(1); }
        }
        
        @keyframes pop {
            0% { transform: scale(1); }
            50% { transform: scale(1.3); }
            100% { transform: scale(1); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.6s ease forwards;
        }
        
        /* 浪漫特效 */
        .floating-hearts {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }
        
        .heart {
            position: absolute;
            color: rgba(255, 107, 157, 0.3);
            font-size: 20px;
            animation: float 8s linear infinite;
        }
        
        @keyframes float {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(-100px) rotate(360deg);
                opacity: 0;
            }
        }
        
        /* 3D控制按钮 - 移动端优化 */
        .toggle3d-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(45deg, #4bc0c8, #c779d0);
            color: white;
            border: none;
            border-radius: 50%;
            width: 55px;
            height: 55px;
            font-size: 1.3rem;
            cursor: pointer;
            z-index: 950;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            transition: all 0.3s;
            display: block !important;
        }
        
        .toggle3d-btn:active {
            transform: scale(1.1);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
        }
        
        /* 新增用户模态框 */
        .user-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 1200;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .user-modal-content {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .user-modal-content h2 {
            text-align: center;
            margin-bottom: 25px;
            color: white;
            font-size: 1.5rem;
        }
        
        .modal-buttons {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }
        
        .modal-btn {
            flex: 1;
            padding: 14px;
            border-radius: 50px;
            border: none;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .modal-btn.primary {
            background: linear-gradient(45deg, #ff6b9d, #c779d0);
            color: white;
        }
        
        .modal-btn.secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .modal-btn:active {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        /* 提示信息 */
        .hint-message {
            position: fixed;
            bottom: 90px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            color: white;
            padding: 12px 25px;
            border-radius: 50px;
            z-index: 910;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
            display: none;
            text-align: center;
            max-width: 90%;
            font-size: 0.9rem;
        }
        
        /* 3D模式提示 */
        .mode-hint {
            position: fixed;
            top: 15px;
            right: 15px;
            background: rgba(255, 107, 157, 0.2);
            color: white;
            padding: 8px 15px;
            border-radius: 30px;
            font-size: 0.85rem;
            z-index: 910;
            display: none;
            border: 1px solid rgba(255, 107, 157, 0.3);
        }
        
        /* 上传成功消息 */
        .message {
            position: fixed;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(45deg, rgba(255, 107, 157, 0.9), rgba(199, 121, 208, 0.9));
            color: white;
            padding: 12px 25px;
            border-radius: 50px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
            z-index: 1100;
            animation: fadeIn 0.3s ease;
            font-weight: 600;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            font-size: 0.95rem;
            max-width: 90%;
            text-align: center;
        }
        
        /* 加载动画 */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(15, 12, 41, 0.95);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 3000;
            flex-direction: column;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #ff6b9d;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* 移动端底部安全区域 */
        .safe-area-bottom {
            padding-bottom: env(safe-area-inset-bottom);
        }
        
        /* 分享按钮 */
        .share-btn {
            display: inline-block;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            padding: 12px 25px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 600;
            transition: all 0.3s;
            border: 1px solid rgba(255, 255, 255, 0.2);
            margin-top: 15px;
        }
        
        .share-btn:active {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }
        
        /* 照片详情视图 */
        .photo-detail-view {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 1100;
            flex-direction: column;
            padding: 20px;
        }
        
        .photo-detail-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        .photo-detail-image {
            max-width: 100%;
            max-height: 70vh;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .photo-detail-info {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            width: 100%;
            max-width: 500px;
            text-align: center;
        }
        
        .photo-detail-title {
            font-size: 1.3rem;
            color: #ff9dc5;
            margin-bottom: 10px;
        }
        
        .photo-detail-date {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
            margin-bottom: 15px;
        }
        
        .photo-detail-actions {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
        }
        
        /* 滑动删除提示 */
        .swipe-hint {
            position: fixed;
            bottom: 150px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 107, 157, 0.2);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 0.85rem;
            z-index: 910;
            display: none;
            border: 1px solid rgba(255, 107, 157, 0.3);
        }
        
        /* 数据备份提醒 */
        .backup-notice {
            background: rgba(75, 192, 200, 0.2);
            border-radius: 10px;
            padding: 12px 15px;
            margin-top: 15px;
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.8);
            text-align: left;
            border: 1px solid rgba(75, 192, 200, 0.3);
        }
        
        .backup-notice i {
            color: #4bc0c8;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <!-- 加载动画 -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
        <p style="margin-top: 20px; color: rgba(255, 255, 255, 0.8);">正在加载您的浪漫记忆...</p>
    </div>
    
    <!-- 登录界面 -->
    <div class="login-container" id="loginContainer">
        <div class="login-box">
            <h1>浪漫记忆之窗</h1>
            <p>输入用户名和密码，开启我们的专属回忆</p>
            
            <div class="input-group">
                <label for="username">用户名</label>
                <input type="text" id="username" placeholder="请输入用户名" autocomplete="username">
            </div>
            
            <div class="input-group">
                <label for="password">密码</label>
                <input type="password" id="password" placeholder="请输入密码" autocomplete="current-password">
            </div>
            
            <div class="remember">
                <input type="checkbox" id="rememberMe">
                <label for="rememberMe">记住我</label>
            </div>
            
            <button class="login-btn" id="loginBtn">
                <i class="fas fa-heart"></i> 进入回忆
            </button>
            
            <div class="error-message" id="errorMessage"></div>
            
            <div class="mobile-tips">
                <i class="fas fa-mobile-alt"></i>
                <span>提示：在手机上可以长按照片保存到相册</span>
            </div>
            
            <div class="backup-notice">
                <i class="fas fa-database"></i>
                <span>您的照片数据会自动保存在手机本地，不会丢失</span>
            </div>
            
            <button class="share-btn" id="shareBtn">
                <i class="fas fa-share-alt"></i> 分享给TA
            </button>
        </div>
    </div>
    
    <!-- 3D照片墙容器 -->
    <div id="photo3dContainer"></div>
    
    <!-- 滑动删除提示 -->
    <div class="swipe-hint" id="swipeHint">
        <i class="fas fa-hand-point-up"></i> 左滑删除照片
    </div>
    
    <!-- 提示信息 -->
    <div class="hint-message" id="hintMessage">
        点击右下角按钮可以切换到上传界面
    </div>
    
    <!-- 3D模式提示 -->
    <div class="mode-hint" id="modeHint">
        <i class="fas fa-cube"></i> 3D模式中
    </div>
    
    <!-- 主内容区域 -->
    <div class="main-container" id="mainContainer">
        <!-- 标题区域 -->
        <div class="header">
            <h1>一路生花</h1>
            <p>珍藏每一刻心动瞬间，记录我们的浪漫故事</p>
            
            <!-- 用户中心 -->
            <div class="user-center">
                <div class="user-info" id="userInfoBtn">
                    <div class="user-avatar" id="userAvatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="user-name" id="userName">用户</div>
                    <i class="fas fa-chevron-down"></i>
                </div>
                
                <div class="user-menu" id="userMenu">
                    <div class="menu-item" id="addUserBtn">
                        <i class="fas fa-user-plus"></i>
                        <span>新增用户</span>
                    </div>
                    <div class="menu-item" id="exportDataBtn">
                        <i class="fas fa-download"></i>
                        <span>导出数据</span>
                    </div>
                    <div class="menu-item" id="importDataBtn">
                        <i class="fas fa-upload"></i>
                        <span>导入数据</span>
                    </div>
                    <div class="menu-item" id="logoutBtn">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>退出登录</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 控制面板 -->
        <div class="control-panel" id="controlPanel">
            <div class="upload-section">
                <button class="upload-btn" id="uploadTrigger">
                    <i class="fas fa-cloud-upload-alt"></i> 上传照片
                </button>
                <input type="file" id="fileInput" accept="image/*" multiple capture="environment">
                <div class="upload-progress" id="uploadProgress">
                    <div class="progress-bar" id="progressBar"></div>
                </div>
            </div>
            
            <div class="photo-counter">
                <i class="fas fa-images"></i>
                <span id="photoCount">0</span> 张照片
            </div>
            
            <div class="filter-section">
                <button class="filter-btn active" data-filter="all">全部</button>
                <button class="filter-btn" data-filter="liked">已点赞</button>
                <button class="filter-btn" data-filter="recent">最近</button>
                <button class="filter-btn" data-filter="oldest">最早</button>
            </div>
        </div>
        
        <!-- 照片墙 -->
        <div class="photo-wall" id="photoWall">
            <!-- 照片将通过JavaScript动态添加 -->
            <div class="empty-state" id="emptyState">
                <i class="fas fa-heart"></i>
                <h2>照片墙空空如也</h2>
                <p>点击上方按钮上传第一张照片，开启浪漫回忆之旅</p>
                <p style="margin-top: 10px; font-size: 0.9rem; color: rgba(255, 255, 255, 0.6);">
                    照片会自动保存在您的设备中
                </p>
            </div>
        </div>
    </div>
    
    <!-- 3D切换按钮 -->
    <button class="toggle3d-btn" id="toggle3dBtn" title="切换3D照片墙">
        <i class="fas fa-cube"></i>
    </button>
    
    <!-- 大图查看模态框 -->
    <div class="modal" id="imageModal">
        <span class="close-modal" id="closeModal">&times;</span>
        <div class="modal-content">
            <img id="modalImage" src="" alt="预览大图">
        </div>
    </div>
    
    <!-- 照片详情视图 -->
    <div class="photo-detail-view" id="photoDetailView">
        <span class="close-modal" id="closeDetailView">&times;</span>
        <div class="photo-detail-content">
            <img id="detailImage" src="" alt="照片详情" class="photo-detail-image">
            <div class="photo-detail-info">
                <div class="photo-detail-title" id="detailTitle"></div>
                <div class="photo-detail-date" id="detailDate"></div>
                <div class="photo-detail-actions">
                    <button class="like-btn" id="detailLikeBtn">
                        <i class="fas fa-heart"></i> <span id="detailLikeCount">0</span>
                    </button>
                    <button class="share-btn" id="detailShareBtn">
                        <i class="fas fa-share"></i> 分享
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 新增用户模态框 -->
    <div class="user-modal" id="userModal">
        <div class="user-modal-content">
            <h2>新增用户</h2>
            
            <div class="input-group">
                <label for="newUsername">用户名</label>
                <input type="text" id="newUsername" placeholder="请输入新用户名">
            </div>
            
            <div class="input-group">
                <label for="newPassword">密码</label>
                <input type="password" id="newPassword" placeholder="请输入密码">
            </div>
            
            <div class="input-group">
                <label for="confirmPassword">确认密码</label>
                <input type="password" id="confirmPassword" placeholder="请再次输入密码">
            </div>
            
            <div class="modal-buttons">
                <button class="modal-btn secondary" id="cancelUserBtn">取消</button>
                <button class="modal-btn primary" id="saveUserBtn">保存用户</button>
            </div>
        </div>
    </div>
    
    <!-- 浪漫特效 -->
    <div class="floating-hearts" id="floatingHearts"></div>
    
    <!-- 引入Three.js库 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.min.js"></script>
    
    <script>
        // ==================== 全局变量 ====================
        let photos = [];
        let currentUser = null;
        let allUsers = [];
        
        // 3D相关变量
        let scene, camera, renderer, controls;
        let photoObjects = [];
        let is3DMinimized = false;
        let is3DHovered = false;
        let animationId = null;
        let is3DInitialized = false;
        
        // 当前显示的照片
        let currentDisplayedPhotos = [];
        
        // 触摸相关变量
        let touchStartX = 0;
        let touchStartY = 0;
        let touchEndX = 0;
        let touchEndY = 0;
        let currentPhotoItem = null;
        
        // DOM元素
        const loginContainer = document.getElementById('loginContainer');
        const mainContainer = document.getElementById('mainContainer');
        const photo3dContainer = document.getElementById('photo3dContainer');
        const photoWall = document.getElementById('photoWall');
        const emptyState = document.getElementById('emptyState');
        const fileInput = document.getElementById('fileInput');
        const uploadTrigger = document.getElementById('uploadTrigger');
        const uploadProgress = document.getElementById('uploadProgress');
        const progressBar = document.getElementById('progressBar');
        const imageModal = document.getElementById('imageModal');
        const modalImage = document.getElementById('modalImage');
        const closeModal = document.getElementById('closeModal');
        const photoCount = document.getElementById('photoCount');
        const filterButtons = document.querySelectorAll('.filter-btn');
        const floatingHearts = document.getElementById('floatingHearts');
        const loginBtn = document.getElementById('loginBtn');
        const usernameInput = document.getElementById('username');
        const passwordInput = document.getElementById('password');
        const rememberMe = document.getElementById('rememberMe');
        const errorMessage = document.getElementById('errorMessage');
        const toggle3dBtn = document.getElementById('toggle3dBtn');
        const userInfoBtn = document.getElementById('userInfoBtn');
        const userMenu = document.getElementById('userMenu');
        const userAvatar = document.getElementById('userAvatar');
        const userName = document.getElementById('userName');
        const addUserBtn = document.getElementById('addUserBtn');
        const exportDataBtn = document.getElementById('exportDataBtn');
        const importDataBtn = document.getElementById('importDataBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const userModal = document.getElementById('userModal');
        const newUsername = document.getElementById('newUsername');
        const newPassword = document.getElementById('newPassword');
        const confirmPassword = document.getElementById('confirmPassword');
        const saveUserBtn = document.getElementById('saveUserBtn');
        const cancelUserBtn = document.getElementById('cancelUserBtn');
        const controlPanel = document.getElementById('controlPanel');
        const hintMessage = document.getElementById('hintMessage');
        const modeHint = document.getElementById('modeHint');
        const loadingOverlay = document.getElementById('loadingOverlay');
        const shareBtn = document.getElementById('shareBtn');
        const photoDetailView = document.getElementById('photoDetailView');
        const detailImage = document.getElementById('detailImage');
        const detailTitle = document.getElementById('detailTitle');
        const detailDate = document.getElementById('detailDate');
        const detailLikeBtn = document.getElementById('detailLikeBtn');
        const detailLikeCount = document.getElementById('detailLikeCount');
        const detailShareBtn = document.getElementById('detailShareBtn');
        const closeDetailView = document.getElementById('closeDetailView');
        const swipeHint = document.getElementById('swipeHint');
        
        // ==================== 初始化应用 ====================
        document.addEventListener('DOMContentLoaded', function() {
            // 显示加载动画
            loadingOverlay.style.display = 'flex';
            
            // 初始化数据
            initializeData();
            
            // 初始化事件监听器
            initEventListeners();
            
            // 检查是否已经登录
            checkLoginStatus();
        });
        
        // 初始化数据
        function initializeData() {
            try {
                // 从本地存储加载数据
                const savedPhotos = localStorage.getItem('romanticPhotoWall');
                const savedUsers = localStorage.getItem('allUsers');
                const savedCurrentUser = localStorage.getItem('currentUser');
                
                // 解析数据
                photos = savedPhotos ? JSON.parse(savedPhotos) : [];
                allUsers = savedUsers ? JSON.parse(savedUsers) : [];
                currentUser = savedCurrentUser ? JSON.parse(savedCurrentUser) : null;
                
                // 如果照片数组为空，添加示例照片
                if (photos.length === 0) {
                    addSamplePhotos();
                }
                
                console.log('数据加载成功，照片数量:', photos.length);
            } catch (error) {
                console.error('数据初始化失败:', error);
                photos = [];
                allUsers = [];
                currentUser = null;
                
                // 添加示例照片
                addSamplePhotos();
            }
        }
        
        // 添加示例照片
        function addSamplePhotos() {
            const samplePhotos = [
                {
                    id: Date.now() + 1,
                    url: 'https://images.unsplash.com/photo-1518568814500-bf0f8d125f46?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=687&q=80',
                    title: '浪漫日落',
                    date: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000).toISOString(),
                    likes: 12,
                    liked: true
                },
                {
                    id: Date.now() + 2,
                    url: 'https://images.unsplash.com/photo-1511988617509-a57c8a288659?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1471&q=80',
                    title: '海边漫步',
                    date: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString(),
                    likes: 8,
                    liked: false
                },
                {
                    id: Date.now() + 3,
                    url: 'https://images.unsplash.com/photo-1529333166437-7750a6dd5a70?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1469&q=80',
                    title: '星空下的约定',
                    date: new Date(Date.now() - 1 * 24 * 60 * 60 * 1000).toISOString(),
                    likes: 15,
                    liked: true
                }
            ];
            
            photos = samplePhotos;
            saveData();
        }
        
        // 初始化事件监听器
        function initEventListeners() {
            // 登录事件
            loginBtn.addEventListener('click', handleLogin);
            passwordInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') loginBtn.click();
            });
            
            // 分享按钮
            shareBtn.addEventListener('click', shareApp);
            
            // 上传事件
            uploadTrigger.addEventListener('click', () => fileInput.click());
            fileInput.addEventListener('change', handleFileUpload);
            
            // 筛选按钮
            filterButtons.forEach(button => {
                button.addEventListener('click', function() {
                    filterButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    const filter = this.dataset.filter;
                    filterPhotos(filter);
                });
            });
            
            // 用户菜单
            userInfoBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                userMenu.classList.toggle('visible');
            });
            
            // 关闭用户菜单
            document.addEventListener('click', function() {
                userMenu.classList.remove('visible');
            });
            
            // 用户相关按钮
            addUserBtn.addEventListener('click', showAddUserModal);
            exportDataBtn.addEventListener('click', exportData);
            importDataBtn.addEventListener('click', importData);
            logoutBtn.addEventListener('click', handleLogout);
            
            // 新增用户模态框
            saveUserBtn.addEventListener('click', saveNewUser);
            cancelUserBtn.addEventListener('click', () => userModal.style.display = 'none');
            
            // 3D切换按钮
            toggle3dBtn.addEventListener('click', toggle3DView);
            
            // 图片模态框
            closeModal.addEventListener('click', closeImageModal);
            imageModal.addEventListener('click', (e) => {
                if (e.target === imageModal) closeImageModal();
            });
            
            // 照片详情视图
            closeDetailView.addEventListener('click', closePhotoDetail);
            detailLikeBtn.addEventListener('click', handleDetailLike);
            detailShareBtn.addEventListener('click', sharePhoto);
            
            // 防止iOS橡皮筋效果
            document.body.addEventListener('touchmove', function(e) {
                if (e.target === document.body || e.target === document.documentElement) {
                    e.preventDefault();
                }
            }, { passive: false });
            
            // 监听窗口大小变化
            window.addEventListener('resize', handleResize);
            
            // 监听页面可见性变化（防止页面隐藏时3D动画继续运行）
            document.addEventListener('visibilitychange', handleVisibilityChange);
        }
        
        // 检查登录状态
        function checkLoginStatus() {
            // 隐藏加载动画
            setTimeout(() => {
                loadingOverlay.style.display = 'none';
                
                // 检查是否有记住的用户
                const savedUser = JSON.parse(localStorage.getItem('photoWallUser'));
                
                if (savedUser && savedUser.username && savedUser.rememberMe) {
                    // 自动填充用户名
                    usernameInput.value = savedUser.username;
                    
                    // 如果记住密码，自动登录
                    if (savedUser.password && validateLogin(savedUser.username, savedUser.password)) {
                        currentUser = { username: savedUser.username, password: savedUser.password };
                        startApp();
                        return;
                    }
                }
                
                // 显示登录界面
                loginContainer.style.display = 'flex';
                
                // 确保3D按钮可见
                toggle3dBtn.style.display = 'block';
            }, 1000);
        }
        
        // ==================== 登录功能 ====================
        async function handleLogin() {
            const username = usernameInput.value.trim();
            const password = passwordInput.value;
            
            if (!username || !password) {
                showError('请输入用户名和密码');
                return;
            }
            
            // 验证用户
            const isValid = validateLogin(username, password);
            
            if (isValid) {
                // 保存用户信息
                const userInfo = {
                    username,
                    rememberMe: rememberMe.checked
                };
                
                // 如果记住密码，保存密码（注意：这里为了安全，我们不建议在前端保存密码）
                // 在实际应用中，应该使用token或其他安全方式
                if (rememberMe.checked) {
                    userInfo.password = password;
                }
                
                // 保存到本地存储
                localStorage.setItem('photoWallUser', JSON.stringify(userInfo));
                localStorage.setItem('currentUser', JSON.stringify({ username, password }));
                
                // 设置当前用户
                currentUser = { username, password };
                
                // 登录成功
                await startApp();
            } else {
                showError('用户名或密码错误');
            }
        }
        
        // 验证登录
        function validateLogin(username, password) {
            // 查找用户
            const user = allUsers.find(u => u.username === username && u.password === password);
            
            if (user) {
                return true;
            }
            
            // 如果没有用户，自动创建第一个用户
            if (allUsers.length === 0) {
                allUsers.push({ username, password });
                saveData();
                return true;
            }
            
            return false;
        }
        
        // ==================== 应用启动 ====================
        async function startApp() {
            // 更新用户界面
            updateUserInfo();
            
            // 淡出登录界面
            loginContainer.style.opacity = '0';
            
            setTimeout(() => {
                loginContainer.style.display = 'none';
                
                // 初始化3D照片墙
                init3DPhotoWall();
                
                // 显示3D照片墙（全屏）
                maximize3DWall();
                
                // 显示提示信息
                setTimeout(() => {
                    hintMessage.style.display = 'block';
                    setTimeout(() => {
                        hintMessage.style.display = 'none';
                    }, 5000);
                }, 1000);
                
                // 显示滑动删除提示
                setTimeout(() => {
                    swipeHint.style.display = 'block';
                    setTimeout(() => {
                        swipeHint.style.display = 'none';
                    }, 8000);
                }, 2000);
                
                // 不显示主界面，直到3D照片墙缩小
                mainContainer.classList.remove('visible');
                controlPanel.style.display = 'none';
                
                // 隐藏用户中心（全屏3D时）
                userInfoBtn.style.display = 'none';
                
                // 显示欢迎消息
                showMessage(`欢迎回来，${currentUser.username}！`);
            }, 800);
        }
        
        // 更新用户信息
        function updateUserInfo() {
            if (currentUser) {
                userName.textContent = currentUser.username;
                
                // 生成用户头像颜色
                const colors = [
                    'linear-gradient(45deg, #ff6b9d, #c779d0)',
                    'linear-gradient(45deg, #4bc0c8, #c779d0)',
                    'linear-gradient(45deg, #ff9a00, #ff6b9d)',
                    'linear-gradient(45deg, #38ef7d, #11998e)'
                ];
                
                const colorIndex = currentUser.username.length % colors.length;
                userAvatar.style.background = colors[colorIndex];
            }
        }
        
        // ==================== 3D照片墙功能 ====================
        function init3DPhotoWall() {
            // 清理现有场景
            cleanup3DScene();
            
            // 创建场景
            scene = new THREE.Scene();
            scene.background = null;
            
            // 创建相机 - 根据设备调整
            const aspect = window.innerWidth / window.innerHeight;
            camera = new THREE.PerspectiveCamera(75, aspect, 0.1, 1000);
            camera.position.z = window.innerWidth < 768 ? 40 : 50;
            camera.position.y = window.innerWidth < 768 ? 15 : 20;
            
            // 创建渲染器
            renderer = new THREE.WebGLRenderer({ 
                antialias: true, 
                alpha: true,
                powerPreference: "high-performance"
            });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setClearColor(0x000000, 0);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2)); // 限制像素比以提高性能
            photo3dContainer.appendChild(renderer.domElement);
            
            // 添加光源
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(10, 20, 15);
            scene.add(directionalLight);
            
            const pointLight = new THREE.PointLight(0xff6b9d, 1, 100);
            pointLight.position.set(0, 10, 20);
            scene.add(pointLight);
            
            // 添加星空背景
            createStarfield();
            
            // 创建照片轨道
            createPhotoOrbits();
            
            // 添加轨道控制 - 移动端优化
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.autoRotate = true;
            controls.autoRotateSpeed = 0.3;
            controls.enableZoom = true;
            controls.enablePan = true;
            controls.maxPolarAngle = Math.PI; // 允许从底部查看
            
            // 开始动画循环
            animate();
            
            // 标记3D已初始化
            is3DInitialized = true;
        }
        
        // 创建星空背景
        function createStarfield() {
            const starGeometry = new THREE.BufferGeometry();
            const starCount = window.innerWidth < 768 ? 1000 : 2000; // 移动端减少星星数量
            const positions = new Float32Array(starCount * 3);
            const colors = new Float32Array(starCount * 3);
            
            for (let i = 0; i < starCount * 3; i += 3) {
                positions[i] = (Math.random() - 0.5) * 1000;
                positions[i + 1] = (Math.random() - 0.5) * 1000;
                positions[i + 2] = (Math.random() - 0.5) * 1000;
                
                const colorChoice = Math.random();
                if (colorChoice < 0.3) {
                    colors[i] = 0.7;
                    colors[i + 1] = 0.8;
                    colors[i + 2] = 1.0;
                } else if (colorChoice < 0.6) {
                    colors[i] = 1.0;
                    colors[i + 1] = 0.7;
                    colors[i + 2] = 0.8;
                } else {
                    colors[i] = 1.0;
                    colors[i + 1] = 1.0;
                    colors[i + 2] = 1.0;
                }
            }
            
            starGeometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
            starGeometry.setAttribute('color', new THREE.BufferAttribute(colors, 3));
            
            const starMaterial = new THREE.PointsMaterial({
                size: window.innerWidth < 768 ? 1.0 : 1.5,
                sizeAttenuation: true,
                vertexColors: true,
                transparent: true,
                opacity: 0.8
            });
            
            const stars = new THREE.Points(starGeometry, starMaterial);
            scene.add(stars);
        }
        
        // 创建照片轨道
        function createPhotoOrbits() {
            photoObjects.forEach(obj => scene.remove(obj));
            photoObjects = [];
            
            if (photos.length === 0) return;
            
            const textureLoader = new THREE.TextureLoader();
            
            // 根据设备调整轨道参数
            const isMobile = window.innerWidth < 768;
            const orbitConfigs = [
                { radius: isMobile ? 15 : 20, height: 0, speed: 0.002 },
                { radius: isMobile ? 22 : 30, height: isMobile ? 3 : 5, speed: -0.0015 },
                { radius: isMobile ? 18 : 25, height: isMobile ? -3 : -5, speed: 0.001 }
            ];
            
            // 为每张照片创建一个平面并放置在轨道上
            photos.forEach((photo, index) => {
                const configIndex = index % orbitConfigs.length;
                const config = orbitConfigs[configIndex];
                const orbitAngle = (index / photos.length) * Math.PI * 2;
                const heightVariation = Math.sin(index * 0.5) * (isMobile ? 5 : 8);
                
                // 调整照片大小
                const planeGeometry = new THREE.PlaneGeometry(isMobile ? 5 : 7, isMobile ? 3.5 : 5);
                
                textureLoader.load(
                    photo.url,
                    (texture) => {
                        const material = new THREE.MeshLambertMaterial({
                            map: texture,
                            side: THREE.DoubleSide,
                            transparent: true,
                            opacity: 0.95
                        });
                        
                        const photoPlane = new THREE.Mesh(planeGeometry, material);
                        photoPlane.position.x = Math.cos(orbitAngle) * config.radius;
                        photoPlane.position.y = config.height + heightVariation;
                        photoPlane.position.z = Math.sin(orbitAngle) * config.radius;
                        photoPlane.lookAt(0, photoPlane.position.y, 0);
                        
                        photoPlane.userData = {
                            orbitRadius: config.radius,
                            orbitAngle: orbitAngle,
                            orbitHeight: config.height,
                            heightVariation: heightVariation,
                            speed: config.speed,
                            rotationSpeed: 0.0005,
                            photoIndex: index
                        };
                        
                        scene.add(photoPlane);
                        photoObjects.push(photoPlane);
                        createPhotoHalo(photoPlane, configIndex);
                    },
                    undefined,
                    (error) => {
                        console.error('纹理加载失败:', error);
                        const material = new THREE.MeshLambertMaterial({
                            color: configIndex === 0 ? 0xff6b9d : (configIndex === 1 ? 0x4bc0c8 : 0xc779d0),
                            side: THREE.DoubleSide,
                            transparent: true,
                            opacity: 0.8
                        });
                        
                        const photoPlane = new THREE.Mesh(planeGeometry, material);
                        photoPlane.position.x = Math.cos(orbitAngle) * config.radius;
                        photoPlane.position.y = config.height + heightVariation;
                        photoPlane.position.z = Math.sin(orbitAngle) * config.radius;
                        photoPlane.lookAt(0, photoPlane.position.y, 0);
                        
                        photoPlane.userData = {
                            orbitRadius: config.radius,
                            orbitAngle: orbitAngle,
                            orbitHeight: config.height,
                            heightVariation: heightVariation,
                            speed: config.speed,
                            rotationSpeed: 0.0005,
                            photoIndex: index
                        };
                        
                        scene.add(photoPlane);
                        photoObjects.push(photoPlane);
                        createPhotoHalo(photoPlane, configIndex);
                    }
                );
            });
        }
        
        // 创建照片光环
        function createPhotoHalo(photoPlane, configIndex) {
            const isMobile = window.innerWidth < 768;
            const haloGeometry = new THREE.RingGeometry(isMobile ? 2.5 : 3.5, isMobile ? 3 : 4, 24);
            const haloMaterial = new THREE.MeshBasicMaterial({
                color: configIndex === 0 ? 0xff6b9d : (configIndex === 1 ? 0x4bc0c8 : 0xc779d0),
                side: THREE.DoubleSide,
                transparent: true,
                opacity: 0.3
            });
            
            const halo = new THREE.Mesh(haloGeometry, haloMaterial);
            halo.position.copy(photoPlane.position);
            halo.lookAt(0, halo.position.y, 0);
            halo.rotation.x = Math.PI / 2;
            
            halo.userData = {
                parent: photoPlane,
                pulseSpeed: 0.02 + Math.random() * 0.02
            };
            
            scene.add(halo);
            photoObjects.push(halo);
        }
        
        // 动画循环
        function animate() {
            animationId = requestAnimationFrame(animate);
            
            if (!is3DInitialized) return;
            
            const time = Date.now() * 0.001;
            
            photoObjects.forEach(obj => {
                if (obj.userData) {
                    if (obj.userData.photoIndex !== undefined) {
                        obj.userData.orbitAngle += obj.userData.speed;
                        obj.position.x = Math.cos(obj.userData.orbitAngle) * obj.userData.orbitRadius;
                        obj.position.z = Math.sin(obj.userData.orbitAngle) * obj.userData.orbitRadius;
                        obj.position.y = obj.userData.orbitHeight + obj.userData.heightVariation + Math.sin(time * 0.5 + obj.userData.orbitAngle) * 3;
                        obj.lookAt(0, obj.position.y, 0);
                        obj.rotation.z += obj.userData.rotationSpeed;
                    } else if (obj.userData.parent) {
                        obj.position.copy(obj.userData.parent.position);
                        obj.lookAt(0, obj.position.y, 0);
                        obj.rotation.x = Math.PI / 2;
                        
                        const scale = 1 + Math.sin(time * obj.userData.pulseSpeed) * 0.1;
                        obj.scale.set(scale, scale, scale);
                    }
                }
            });
            
            controls.update();
            renderer.render(scene, camera);
        }
        
        // 清理3D场景
        function cleanup3DScene() {
            if (animationId) {
                cancelAnimationFrame(animationId);
                animationId = null;
            }
            
            if (scene) {
                while(scene.children.length > 0) { 
                    scene.remove(scene.children[0]); 
                }
            }
            
            if (renderer) {
                renderer.dispose();
                renderer = null;
            }
            
            if (controls) {
                controls.dispose();
                controls = null;
            }
            
            photoObjects = [];
            
            if (photo3dContainer) {
                photo3dContainer.innerHTML = '';
            }
            
            is3DInitialized = false;
        }
        
        // ==================== 3D视图切换 ====================
        function toggle3DView() {
            if (is3DMinimized) {
                maximize3DWall();
            } else {
                minimize3DWall();
            }
        }
        
        function minimize3DWall() {
            is3DMinimized = true;
            photo3dContainer.classList.add('minimized');
            
            if (camera && renderer) {
                const width = window.innerWidth < 768 ? 120 : 200;
                const height = window.innerWidth < 768 ? 90 : 150;
                camera.aspect = width / height;
                camera.updateProjectionMatrix();
                renderer.setSize(width, height);
            }
            
            mainContainer.classList.add('visible');
            controlPanel.style.display = 'flex';
            refreshPhotoWall();
            toggle3dBtn.innerHTML = '<i class="fas fa-expand"></i>';
            userInfoBtn.style.display = 'flex';
            modeHint.style.display = 'none';
        }
        
        function maximize3DWall() {
            is3DMinimized = false;
            photo3dContainer.classList.remove('minimized');
            
            if (camera && renderer) {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            }
            
            mainContainer.classList.remove('visible');
            controlPanel.style.display = 'none';
            userInfoBtn.style.display = 'none';
            toggle3dBtn.innerHTML = '<i class="fas fa-compress"></i>';
            modeHint.style.display = 'block';
        }
        
        // ==================== 照片管理 ====================
        // 刷新照片墙
        function refreshPhotoWall() {
            updatePhotoCount();
            const activeFilter = document.querySelector('.filter-btn.active').dataset.filter;
            filterPhotos(activeFilter);
            createFloatingHearts();
            
            if (photos.length === 0) {
                emptyState.style.display = 'block';
                emptyState.innerHTML = `
                    <i class="fas fa-heart"></i>
                    <h2>照片墙空空如也</h2>
                    <p>点击上方按钮上传第一张照片，开启浪漫回忆之旅</p>
                    <p style="margin-top: 10px; font-size: 0.9rem; color: rgba(255, 255, 255, 0.6);">
                        照片会自动保存在您的设备中
                    </p>
                `;
            } else {
                emptyState.style.display = 'none';
            }
        }
        
        // 渲染照片
        function renderPhotos(photosToRender) {
            currentDisplayedPhotos = photosToRender;
            const existingPhotos = document.querySelectorAll('.photo-item');
            existingPhotos.forEach(photo => photo.remove());
            
            photosToRender.forEach((photo, displayIndex) => {
                const photoItem = createPhotoElement(photo, displayIndex);
                photoWall.appendChild(photoItem);
            });
        }
        
        // 创建照片元素
        function createPhotoElement(photo, displayIndex) {
            const photoItem = document.createElement('div');
            photoItem.className = 'photo-item fade-in';
            photoItem.dataset.id = photo.id;
            photoItem.dataset.displayIndex = displayIndex;
            photoItem.dataset.liked = photo.liked;
            photoItem.dataset.date = photo.date;
            
            photoItem.innerHTML = `
                <img src="${photo.url}" alt="${photo.title}" loading="lazy">
                <div class="photo-info">
                    <div class="photo-title">${photo.title}</div>
                    <div class="photo-date">${formatDate(photo.date)}</div>
                    <div class="photo-actions">
                        <button class="like-btn ${photo.liked ? 'liked' : ''}" data-id="${photo.id}">
                            <i class="fas fa-heart"></i> ${photo.likes}
                        </button>
                        <button class="delete-btn" data-id="${photo.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `;
            
            const img = photoItem.querySelector('img');
            const likeBtn = photoItem.querySelector('.like-btn');
            const deleteBtn = photoItem.querySelector('.delete-btn');
            
            // 点击图片查看大图
            img.addEventListener('click', () => openPhotoDetail(photo));
            
            // 长按图片保存
            img.addEventListener('touchstart', (e) => {
                touchStartX = e.touches[0].clientX;
                touchStartY = e.touches[0].clientY;
                currentPhotoItem = photoItem;
                
                // 长按定时器
                const longPressTimer = setTimeout(() => {
                    showSavePhotoDialog(photo);
                }, 1000);
                
                // 触摸结束清除定时器
                img.addEventListener('touchend', () => clearTimeout(longPressTimer), { once: true });
                img.addEventListener('touchmove', () => clearTimeout(longPressTimer), { once: true });
            });
            
            // 点赞按钮
            likeBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                const photoId = parseInt(e.currentTarget.getAttribute('data-id'));
                toggleLike(photoId);
            });
            
            // 删除按钮
            deleteBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                const photoId = parseInt(e.currentTarget.getAttribute('data-id'));
                deletePhoto(photoId);
            });
            
            // 添加触摸滑动删除
            addSwipeDelete(photoItem, photo.id);
            
            return photoItem;
        }
        
        // 添加滑动删除功能
        function addSwipeDelete(photoItem, photoId) {
            let startX = 0;
            let currentX = 0;
            let isSwiping = false;
            
            photoItem.addEventListener('touchstart', (e) => {
                startX = e.touches[0].clientX;
                currentX = startX;
                isSwiping = true;
                photoItem.style.transition = 'none';
            });
            
            photoItem.addEventListener('touchmove', (e) => {
                if (!isSwiping) return;
                currentX = e.touches[0].clientX;
                const diff = currentX - startX;
                
                // 只允许向左滑动
                if (diff < 0) {
                    photoItem.style.transform = `translateX(${diff}px)`;
                    
                    // 如果滑动距离超过100px，显示删除提示
                    if (Math.abs(diff) > 100) {
                        photoItem.style.backgroundColor = 'rgba(255, 107, 107, 0.2)';
                    } else {
                        photoItem.style.backgroundColor = '';
                    }
                }
            });
            
            photoItem.addEventListener('touchend', () => {
                if (!isSwiping) return;
                isSwiping = false;
                
                const diff = currentX - startX;
                
                // 如果滑动距离超过150px，确认删除
                if (diff < -150) {
                    if (confirm('确定要删除这张照片吗？')) {
                        deletePhoto(photoId);
                    } else {
                        photoItem.style.transform = '';
                        photoItem.style.transition = 'transform 0.3s ease';
                        photoItem.style.backgroundColor = '';
                    }
                } else {
                    photoItem.style.transform = '';
                    photoItem.style.transition = 'transform 0.3s ease';
                    photoItem.style.backgroundColor = '';
                }
            });
        }
        
        // 上传照片处理
        async function handleFileUpload(e) {
            const files = e.target.files;
            if (files.length === 0) return;
            
            // 限制上传数量
            if (files.length > 10) {
                alert('一次最多上传10张照片');
                return;
            }
            
            uploadProgress.style.display = 'block';
            progressBar.style.width = '0%';
            
            let uploadedCount = 0;
            const totalFiles = files.length;
            
            const processFile = (file, index) => {
                return new Promise((resolve) => {
                    if (!file.type.startsWith('image/')) {
                        alert(`文件 "${file.name}" 不是图片格式，已跳过`);
                        uploadedCount++;
                        updateProgress();
                        resolve();
                        return;
                    }
                    
                    // 检查文件大小（限制为5MB）
                    if (file.size > 5 * 1024 * 1024) {
                        alert(`文件 "${file.name}" 太大（超过5MB），已跳过`);
                        uploadedCount++;
                        updateProgress();
                        resolve();
                        return;
                    }
                    
                    const reader = new FileReader();
                    
                    reader.onload = function(event) {
                        const newPhoto = {
                            id: Date.now() + index,
                            url: event.target.result,
                            title: file.name.split('.')[0] || `照片 ${photos.length + 1}`,
                            date: new Date().toISOString(),
                            likes: 0,
                            liked: false,
                            uploadedBy: currentUser.username,
                            uploadedAt: Date.now()
                        };
                        
                        photos.unshift(newPhoto);
                        uploadedCount++;
                        updateProgress();
                        
                        // 保存数据
                        saveData();
                        
                        resolve();
                    };
                    
                    reader.onerror = function() {
                        alert(`读取文件 "${file.name}" 时出错`);
                        uploadedCount++;
                        updateProgress();
                        resolve();
                    };
                    
                    reader.readAsDataURL(file);
                });
            };
            
            function updateProgress() {
                const progress = (uploadedCount / totalFiles) * 100;
                progressBar.style.width = `${progress}%`;
                
                if (uploadedCount === totalFiles) {
                    setTimeout(() => {
                        uploadProgress.style.display = 'none';
                        progressBar.style.width = '0%';
                        
                        showMessage(`成功上传 ${uploadedCount} 张照片`);
                        
                        // 重新创建3D照片墙
                        createPhotoOrbits();
                        
                        if (is3DMinimized) {
                            refreshPhotoWall();
                        }
                    }, 500);
                }
            }
            
            const processFiles = async () => {
                for (let i = 0; i < files.length; i++) {
                    await processFile(files[i], i);
                }
            };
            
            await processFiles();
            fileInput.value = '';
        }
        
        // 切换点赞状态
        function toggleLike(photoId) {
            const originalIndex = photos.findIndex(photo => photo.id === photoId);
            if (originalIndex === -1) return;
            
            photos[originalIndex].liked = !photos[originalIndex].liked;
            photos[originalIndex].likes += photos[originalIndex].liked ? 1 : -1;
            
            // 保存数据
            saveData();
            
            // 更新3D照片墙
            createPhotoOrbits();
            
            // 更新照片墙
            const activeFilter = document.querySelector('.filter-btn.active').dataset.filter;
            filterPhotos(activeFilter);
            
            showMessage(`照片已${photos[originalIndex].liked ? '点赞' : '取消点赞'}！`);
        }
        
        // 删除照片
        function deletePhoto(photoId) {
            const originalIndex = photos.findIndex(photo => photo.id === photoId);
            if (originalIndex === -1) return;
            
            if (confirm('确定要删除这张照片吗？删除后无法恢复。')) {
                photos.splice(originalIndex, 1);
                
                // 保存数据
                saveData();
                
                // 更新3D照片墙
                createPhotoOrbits();
                
                // 更新照片墙
                refreshPhotoWall();
                
                showMessage('照片已删除！');
            }
        }
        
        // 筛选照片
        function filterPhotos(filter) {
            let filteredPhotos = [...photos];
            
            switch(filter) {
                case 'liked':
                    filteredPhotos = photos.filter(photo => photo.liked);
                    break;
                case 'recent':
                    // 最近上传的照片
                    filteredPhotos = [...photos].sort((a, b) => new Date(b.date) - new Date(a.date));
                    break;
                case 'oldest':
                    // 最早的照片
                    filteredPhotos = [...photos].sort((a, b) => new Date(a.date) - new Date(b.date));
                    break;
                case 'all':
                default:
                    filteredPhotos = photos;
            }
            
            renderPhotos(filteredPhotos);
            photoCount.textContent = filteredPhotos.length;
            
            if (filteredPhotos.length === 0) {
                emptyState.style.display = 'block';
                emptyState.innerHTML = `
                    <i class="fas fa-search"></i>
                    <h2>没有找到符合条件的照片</h2>
                    <p>尝试其他筛选条件或上传新照片</p>
                `;
            } else {
                emptyState.style.display = 'none';
            }
        }
        
        // ==================== 照片详情功能 ====================
        function openPhotoDetail(photo) {
            detailImage.src = photo.url;
            detailTitle.textContent = photo.title;
            detailDate.textContent = `上传时间：${formatDate(photo.date)}`;
            detailLikeCount.textContent = photo.likes;
            
            // 更新点赞按钮状态
            detailLikeBtn.className = photo.liked ? 'like-btn liked' : 'like-btn';
            detailLikeBtn.innerHTML = `<i class="fas fa-heart"></i> <span id="detailLikeCount">${photo.likes}</span>`;
            
            // 保存当前照片ID到按钮
            detailLikeBtn.dataset.photoId = photo.id;
            
            photoDetailView.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }
        
        function closePhotoDetail() {
            photoDetailView.style.display = 'none';
            document.body.style.overflow = 'auto';
        }
        
        function handleDetailLike() {
            const photoId = parseInt(detailLikeBtn.dataset.photoId);
            if (photoId) {
                toggleLike(photoId);
                
                // 更新详情视图
                const photo = photos.find(p => p.id === photoId);
                if (photo) {
                    detailLikeCount.textContent = photo.likes;
                    detailLikeBtn.className = photo.liked ? 'like-btn liked' : 'like-btn';
                }
            }
        }
        
        // ==================== 数据管理 ====================
        function saveData() {
            try {
                localStorage.setItem('romanticPhotoWall', JSON.stringify(photos));
                localStorage.setItem('allUsers', JSON.stringify(allUsers));
                if (currentUser) {
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                }
                
                console.log('数据保存成功');
                return true;
            } catch (error) {
                console.error('数据保存失败:', error);
                showMessage('数据保存失败，请检查存储空间');
                return false;
            }
        }
        
        function exportData() {
            const data = {
                photos: photos,
                users: allUsers,
                exportedAt: new Date().toISOString(),
                version: '1.0'
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const downloadLink = document.createElement('a');
            downloadLink.href = URL.createObjectURL(dataBlob);
            downloadLink.download = `浪漫记忆备份_${new Date().toISOString().split('T')[0]}.json`;
            downloadLink.click();
            
            showMessage('数据导出成功！');
        }
        
        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'application/json';
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(event) {
                    try {
                        const data = JSON.parse(event.target.result);
                        
                        if (data.photos && Array.isArray(data.photos)) {
                            photos = data.photos;
                            if (data.users && Array.isArray(data.users)) {
                                allUsers = data.users;
                            }
                            
                            saveData();
                            createPhotoOrbits();
                            refreshPhotoWall();
                            
                            showMessage('数据导入成功！');
                        } else {
                            throw new Error('数据格式不正确');
                        }
                    } catch (error) {
                        alert('数据导入失败：' + error.message);
                    }
                };
                reader.readAsText(file);
            };
            
            input.click();
        }
        
        // ==================== 用户管理 ====================
        function showAddUserModal() {
            userMenu.classList.remove('visible');
            userModal.style.display = 'flex';
            newUsername.value = '';
            newPassword.value = '';
            confirmPassword.value = '';
        }
        
        function saveNewUser() {
            const username = newUsername.value.trim();
            const password = newPassword.value;
            const confirm = confirmPassword.value;
            
            if (!username || !password) {
                alert('请输入用户名和密码');
                return;
            }
            
            if (password !== confirm) {
                alert('两次输入的密码不一致');
                return;
            }
            
            const userExists = allUsers.some(user => user.username === username);
            if (userExists) {
                alert('用户名已存在，请使用其他用户名');
                return;
            }
            
            allUsers.push({ username, password });
            saveData();
            
            userModal.style.display = 'none';
            showMessage('用户创建成功！');
        }
        
        // ==================== 退出登录 ====================
        function handleLogout() {
            userMenu.classList.remove('visible');
            
            if (confirm('确定要退出登录吗？')) {
                // 清理3D场景
                cleanup3DScene();
                
                // 清除当前用户
                currentUser = null;
                localStorage.removeItem('currentUser');
                
                // 隐藏所有界面
                mainContainer.classList.remove('visible');
                controlPanel.style.display = 'none';
                photo3dContainer.style.display = 'none';
                userInfoBtn.style.display = 'none';
                hintMessage.style.display = 'none';
                modeHint.style.display = 'none';
                swipeHint.style.display = 'none';
                
                // 3D切换按钮保持显示
                toggle3dBtn.style.display = 'block';
                toggle3dBtn.innerHTML = '<i class="fas fa-cube"></i>';
                toggle3dBtn.title = "切换3D照片墙";
                
                // 显示登录界面
                loginContainer.style.display = 'flex';
                loginContainer.style.opacity = '1';
                
                // 清空登录表单
                usernameInput.value = '';
                passwordInput.value = '';
                rememberMe.checked = false;
                
                // 重置3D状态
                is3DMinimized = false;
                is3DHovered = false;
                
                showMessage('已退出登录');
            }
        }
        
        // ==================== 分享功能 ====================
        function shareApp() {
            if (navigator.share) {
                navigator.share({
                    title: '我们的浪漫记忆',
                    text: '一起查看我们的浪漫回忆照片墙',
                    url: window.location.href
                }).then(() => {
                    showMessage('分享成功！');
                }).catch((error) => {
                    console.log('分享失败:', error);
                    copyToClipboard(window.location.href);
                });
            } else {
                copyToClipboard(window.location.href);
            }
        }
        
        function sharePhoto() {
            const currentPhoto = photos.find(p => p.id === parseInt(detailLikeBtn.dataset.photoId));
            if (!currentPhoto) return;
            
            if (navigator.share) {
                navigator.share({
                    title: currentPhoto.title,
                    text: '分享我们的浪漫回忆',
                    url: currentPhoto.url
                }).then(() => {
                    showMessage('照片分享成功！');
                }).catch((error) => {
                    console.log('分享失败:', error);
                    copyToClipboard(currentPhoto.url);
                });
            } else {
                copyToClipboard(currentPhoto.url);
            }
        }
        
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showMessage('链接已复制到剪贴板！');
            }).catch((error) => {
                console.error('复制失败:', error);
                showMessage('复制失败，请手动复制链接');
            });
        }
        
        // ==================== 工具函数 ====================
        function updatePhotoCount() {
            photoCount.textContent = photos.length;
        }
        
        function formatDate(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffTime = Math.abs(now - date);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            if (diffDays === 1) {
                return '昨天';
            } else if (diffDays === 2) {
                return '前天';
            } else if (diffDays <= 7) {
                return `${diffDays}天前`;
            } else {
                return date.toLocaleDateString('zh-CN', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
            }
        }
        
        function openModal(imageUrl) {
            modalImage.src = imageUrl;
            imageModal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }
        
        function closeImageModal() {
            imageModal.style.display = 'none';
            document.body.style.overflow = 'auto';
        }
        
        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
            setTimeout(() => {
                errorMessage.style.display = 'none';
            }, 3000);
        }
        
        function showMessage(text) {
            const oldMessage = document.querySelector('.message');
            if (oldMessage) oldMessage.remove();
            
            const message = document.createElement('div');
            message.className = 'message';
            message.textContent = text;
            document.body.appendChild(message);
            
            setTimeout(() => {
                message.style.opacity = '0';
                message.style.transition = 'opacity 0.5s';
                setTimeout(() => message.remove(), 500);
            }, 3000);
        }
        
        function createFloatingHearts() {
            floatingHearts.innerHTML = '';
            const heartCount = Math.min(photos.length * 2, 30);
            
            for (let i = 0; i < heartCount; i++) {
                const heart = document.createElement('div');
                heart.className = 'heart';
                heart.innerHTML = '❤';
                
                const size = Math.random() * 20 + 15;
                const left = Math.random() * 100;
                const delay = Math.random() * 5;
                const duration = Math.random() * 10 + 10;
                
                heart.style.cssText = `
                    left: ${left}vw;
                    font-size: ${size}px;
                    animation-delay: ${delay}s;
                    animation-duration: ${duration}s;
                `;
                
                floatingHearts.appendChild(heart);
            }
        }
        
        function showSavePhotoDialog(photo) {
            if (confirm('是否将这张照片保存到手机相册？')) {
                savePhotoToDevice(photo.url, photo.title);
            }
        }
        
        function savePhotoToDevice(imageUrl, filename) {
            const link = document.createElement('a');
            link.href = imageUrl;
            link.download = filename || '浪漫记忆照片.jpg';
            link.click();
            
            showMessage('照片下载已开始，请查看手机相册');
        }
        
        function handleResize() {
            if (is3DInitialized) {
                if (!is3DMinimized) {
                    camera.aspect = window.innerWidth / window.innerHeight;
                    camera.updateProjectionMatrix();
                    renderer.setSize(window.innerWidth, window.innerHeight);
                } else {
                    const width = window.innerWidth < 768 ? 120 : 200;
                    const height = window.innerWidth < 768 ? 90 : 150;
                    camera.aspect = width / height;
                    camera.updateProjectionMatrix();
                    renderer.setSize(width, height);
                }
            }
        }
        
        function handleVisibilityChange() {
            if (document.hidden) {
                // 页面隐藏时暂停3D动画
                if (animationId) {
                    cancelAnimationFrame(animationId);
                    animationId = null;
                }
            } else if (is3DInitialized && !animationId) {
                // 页面显示时恢复3D动画
                animate();
            }
        }
        
        // 防止iOS双击缩放
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function(event) {
            const now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);
        
        // 阻止iOS下拉刷新
        document.addEventListener('touchmove', function(e) {
            if (e.scale !== 1) {
                e.preventDefault();
            }
        }, { passive: false });
        
        console.log('浪漫记忆应用初始化完成！');
        console.log('照片数量:', photos.length);
        console.log('用户数量:', allUsers.length);
    </script>
</body>
</html>
